"use strict";(self.webpackChunktechnical_notes_for_microsoft_workloads_on_aws=self.webpackChunktechnical_notes_for_microsoft_workloads_on_aws||[]).push([[3203],{3248:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"SQL-Server/Guides/Guide2/index","title":"Amazon FSx for ONTAP: SQL Server Snapshot-Based Backup Automation Script","description":"This PowerShell script will automate the T-SQL backup flow utilizing snapshots on Amazon FSx for ONTAP filesystem and TSQL suspend and metadata backup. This will replace the","source":"@site/docs/SQL-Server/Guides/Guide2/index.md","sourceDirName":"SQL-Server/Guides/Guide2","slug":"/SQL-Server/Guides/Guide2/","permalink":"/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/Guide2/","draft":false,"unlisted":false,"editUrl":"https://github.com/aws-samples/technical-notes-for-microsoft-workloads-on-aws/blob/main/docusaurus/docs/SQL-Server/Guides/Guide2/index.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"sidebar_label":"Automate SQL backup using snapshots on Amazon FSx for ONTAP"},"sidebar":"tutorialSidebar","previous":{"title":"Amazon RDS for SQL Server with self-managed Active Directory","permalink":"/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/Guide1/"},"next":{"title":"FAQs","permalink":"/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/FAQs/"}}');var r=a(4848),o=a(8453);const t={sidebar_position:20,sidebar_label:"Automate SQL backup using snapshots on Amazon FSx for ONTAP"},i="Amazon FSx for ONTAP: SQL Server Snapshot-Based Backup Automation Script",c={},l=[];function d(e){const s={a:"a",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"amazon-fsx-for-ontap-sql-server-snapshot-based-backup-automation-script",children:"Amazon FSx for ONTAP: SQL Server Snapshot-Based Backup Automation Script"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"https://github.com/aws-samples/technical-notes-for-microsoft-workloads-on-aws/tree/main/docusaurus/docs/SQL-Server/Guides/Guide2/Scripts/TSQL_Backup.ps1",children:"This PowerShell script"})," will automate the T-SQL backup flow utilizing snapshots on Amazon FSx for ONTAP filesystem and TSQL suspend and metadata backup. This will replace the\nfull and incremental backups of SQL. Recommended to run every 6hrs or at desired frequency. Transaction log backups would continue in the traditional way more frequently at 15min or lesser as needed."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"https://github.com/aws-samples/technical-notes-for-microsoft-workloads-on-aws/tree/main/docusaurus/docs/SQL-Server/Guides/Guide2/Scripts/TSQL_Backup.ps1",children:"The PowerShell script"})," fetches the disks assigned to SQL instance/databases and maps that back to LUN and volume on Amazon FSx for ONTAP. You can run at the required schedule using SQL agent or Windows scheduler."]}),"\n",(0,r.jsx)(s.h1,{id:"script-location",children:"Script Location"}),"\n",(0,r.jsxs)(s.p,{children:["Get the script here: ",(0,r.jsx)(s.a,{href:"https://github.com/aws-samples/technical-notes-for-microsoft-workloads-on-aws/tree/main/docusaurus/docs/SQL-Server/Guides/Guide2/Scripts/TSQL_Backup.ps1",children:"TSQL_Backup.ps1"})]}),"\n",(0,r.jsx)(s.h1,{id:"pre-requisites",children:"Pre-requisites:"}),"\n",(0,r.jsx)(s.p,{children:"Some of the pre-requisites are as follows:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Store the Amazon FSx credentials as an AWS Systems Manager Parameter Store parameter for secure storage and retrieval\na. ",(0,r.jsx)(s.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-su-create.html",children:"Create a SecureString parameter"})," named ",(0,r.jsx)(s.code,{children:"/tsql/filesystem/<FSxN filesystem ID>"}),". Replaced ",(0,r.jsx)(s.code,{children:"<FSxN filesystem ID>"})," with Amazon FSxN ID."]}),"\n",(0,r.jsx)(s.p,{children:"b. Set its value to a JSON object with your FSx username and password. Example:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:"{\n    fsx: {\n        username: 'fsxadmin',\n        password: 'password'\n    }\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"https://docs.aws.amazon.com/powershell/v4/userguide/pstools-getting-set-up-windows.html#ps-installing-awstools",children:"Install"})," AWS.Tools.SimpleSystemsManagement PowerShell module on the system where script is running."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h1,{id:"usage",children:"Usage:"}),"\n",(0,r.jsx)(s.h1,{id:"to-run-backup-on-a-single-database",children:"To run backup on a single database:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"TSQL_Backup.ps1 -FSxID <FSx filesystem ID> -FSxRegion <AWS region> -serverInstanceName <SQL Server instance name> -databaseName <database name>\n"})}),"\n",(0,r.jsx)(s.p,{children:"Example:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"TSQL_Backup.ps1 -FSxID 'fs-07a22f282fd4f5a20' -FSxRegion 'eu-south-2' -serverInstanceName 'MSSQLSERVER' -databaseName 'Finance'\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"TSQL_Backup.ps1 -FSxID 'fs-07a22f282fd4f5a20' -FSxRegion 'eu-south-2' -serverInstanceName 'ENGINEERING' -databaseName 'Payments'\n"})}),"\n",(0,r.jsx)(s.h1,{id:"to-run-backup-on-a-group-of-databases",children:"To run backup on a group of databases:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"TSQL_Backup.ps1 -FSxID <FSx filesystem ID> -FSxRegion <AWS region> -serverInstanceName <SQL Server instance name> -databaseName <comma-separated database names>\n"})}),"\n",(0,r.jsx)(s.p,{children:"Example:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"TSQL_Backup.ps1 -FSxID 'fs-07a22f282fd4f5a20' -FSxRegion 'eu-south-2' -serverInstanceName 'ENGINEERING' -databaseName 'Finance,Resources,Accounts'\n"})}),"\n",(0,r.jsx)(s.h1,{id:"to-run-backup-on-a-serverall-databases",children:"To run backup on a Server(all databases):"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"TSQL_Backup.ps1 -FSxID <FSx filesystem ID> -FSxRegion <AWS region> -serverInstanceName <SQL Server instance name>\n"})}),"\n",(0,r.jsx)(s.p,{children:"Example:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"TSQL_Backup.ps1 -FSxID 'fs-07a22f282fd4f5a20' -FSxRegion 'eu-south-2' -serverInstanceName 'ENGINEERING'\n"})})]})}function u(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,s,a)=>{a.d(s,{R:()=>t,x:()=>i});var n=a(6540);const r={},o=n.createContext(r);function t(e){const s=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),n.createElement(o.Provider,{value:s},e.children)}}}]);